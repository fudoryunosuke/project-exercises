<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>道路管理システム - マップ表示</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com?plugins=forms"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link id="app-style" rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<!-- サイドバー -->
<aside id="sidebar" class="w-64 bg-gray-900 border-r border-gray-800 flex flex-col p-4">
  <div id="toggleSidebar">☰</div>
  <h1 class="text-xl font-bold text-yellow-400 mb-4 sidebar-text">道路管理システム</h1>

  <nav class="mb-4 border-b border-gray-700 pb-4">
    <a href="dashboard.html" class="block px-4 py-2 rounded hover:bg-gray-800 text-gray-400 mb-2 sidebar-link">
      <span class="sidebar-text">ダッシュボード</span>
    </a>
    <a href="index.html" class="block px-4 py-2 rounded bg-gray-800 text-white mb-2 sidebar-link">
      <span class="sidebar-text">マップ表示</span>
    </a>
    <a href="search.html" class="block px-4 py-2 rounded hover:bg-gray-800 text-gray-400 sidebar-link">
      <span class="sidebar-text">損傷検索</span>
    </a>
  </nav>

  <div class="mb-4 border-b border-gray-700 pb-4">
    <h2 class="text-gray-400 font-semibold mb-2 sidebar-text">フィルター</h2>
    <label class="block text-sm font-semibold text-gray-400 mb-1 sidebar-text">月</label>
    <select id="month-filter" class="w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white mb-3">
      <option>全て</option>
    </select>

    <label class="block text-sm font-semibold text-gray-400 mb-1 sidebar-text">損傷度</label>
    <select id="severity-filter" class="w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white mb-3">
      <option>全て</option>
    </select>

    <label class="block text-sm font-semibold text-gray-400 mb-1 sidebar-text">損傷の種類</label>
    <select id="type-filter" class="w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white mb-3">
      <option>全て</option>
    </select>

    <label class="block text-sm font-semibold text-gray-400 mb-1 sidebar-text">対応状況</label>
    <select id="status-filter" class="w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white">
      <option>全て</option>
      <option value="pending">未対応</option>
      <option value="in-progress">対応中</option>
      <option value="completed">対応完了</option>
      <option value="cancelled">対応不要</option>
    </select>
  </div>

  <!-- リセットボタン -->
  <button id="reset-filters" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded mt-2 sidebar-text">リセット</button>

  <!-- 凡例 -->
  <div class="mt-4 sidebar-text">
    <h3 class="text-sm font-semibold text-gray-400 mb-2">破損度</h3>
    <div class="legend-item"><span class="legend-dot legend-high"></span> 高度</div>
    <div class="legend-item"><span class="legend-dot legend-medium"></span> 中度</div>
    <div class="legend-item"><span class="legend-dot legend-low"></span> 低度</div>
  </div>

  
</aside>

<!-- マップ + 対応状況パネルの横並びコンテナ -->
<div style="display:flex; gap:1rem; flex:1; padding:1rem;">
  <!-- マップ表示 -->
  <div style="flex:1; display:flex;">
    <div id="map" style="flex:1;"></div>
  </div>

  <!-- 対応状況パネル -->
  <aside id="status-panel" style="width:24rem; background:#111827; border:1px solid #374151; border-radius:0.75rem; padding:1rem; display:none; flex-direction:column; gap:0.75rem;">
    <h2 style="color:#facc15; font-weight:700;">対応状況</h2>
    <div id="status-meta" style="color:#d1d5db; font-size:0.9rem;"></div>

    <!-- 損傷画像 -->
    <div>
      <img id="status-image" alt="損傷画像" style="width:100%; max-height:200px; object-fit:cover; border-radius:0.5rem; border:1px solid #374151; display:none;" />
    </div>

    <!-- ステータス選択 -->
    <div>
      <label style="color:#9ca3af; font-weight:600; font-size:0.9rem;">状態</label>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem; margin-top:0.5rem;">
        <button type="button" data-status="pending" class="status-btn">未対応</button>
        <button type="button" data-status="in-progress" class="status-btn">対応中</button>
        <button type="button" data-status="completed" class="status-btn">対応完了</button>
        <button type="button" data-status="cancelled" class="status-btn">対応不要</button>
      </div>
    </div>

    <!-- 完了日 -->
    <div>
      <label for="responseDate" style="color:#9ca3af; font-weight:600; font-size:0.9rem;">完了日</label>
      <input id="responseDate" type="date" style="width:100%; background:#1f2937; border:1px solid #374151; color:#f9fafb; border-radius:0.375rem; padding:0.5rem;" />
    </div>

    <!-- 対応内容 -->
    <div>
      <label for="responseDetails" style="color:#9ca3af; font-weight:600; font-size:0.9rem;">対応内容</label>
      <textarea id="responseDetails" rows="3" style="width:100%; background:#1f2937; border:1px solid #374151; color:#f9fafb; border-radius:0.375rem; padding:0.5rem;"></textarea>
    </div>

    <!-- 特記事項 -->
    <div>
      <label for="responseNotes" style="color:#9ca3af; font-weight:600; font-size:0.9rem;">特記事項</label>
      <textarea id="responseNotes" rows="3" style="width:100%; background:#1f2937; border:1px solid #374151; color:#f9fafb; border-radius:0.375rem; padding:0.5rem;"></textarea>
    </div>

    <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
      <button id="saveStatus" style="flex:1; background:#059669; color:#fff; padding:0.5rem 0.75rem; border:none; border-radius:0.375rem; font-weight:700;">保存</button>
      <button id="toSearch" style="background:#2563eb; color:#fff; padding:0.5rem 0.75rem; border:none; border-radius:0.375rem; font-weight:700;">損傷検索へ</button>
      <button id="closeStatus" style="background:#374151; color:#fff; padding:0.5rem 0.75rem; border:none; border-radius:0.375rem;">閉じる</button>
    </div>
  </aside>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
(function(){
  const v = String(Date.now());
  function load(src, onload){ 
    const s = document.createElement('script'); 
    s.src = src + '?v=' + v; 
    s.onload = onload;
    document.body.appendChild(s); 
  }

  // damages.js を先にロードし終わってから map.js をロード
  load('assets/js/damages.js', () => {
    load('assets/js/map.js');
  });
})();
</script>
</body>
</html>
